-- GUI to Lua
-- Version: 3.2

-- Variable pour stocker la dernière position
local lastPosition = UDim2.new(0.39259696, 0, 0.373115569, 0) -- Position par défaut

-- Function to create the GUI
local function createGUI()
    -- Instances:
    local ScreenGui = Instance.new("ScreenGui")
    local Frame = Instance.new("Frame")
    local UICorner = Instance.new("UICorner")
    local TextLabel = Instance.new("TextLabel")
    local UICorner_2 = Instance.new("UICorner")

    -- Properties:
    ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

    Frame.Parent = ScreenGui
    Frame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    Frame.BackgroundTransparency = 1.000 -- Rendre la Frame complètement transparente
    Frame.BorderColor3 = Color3.fromRGB(0, 0, 0)
    Frame.BorderSizePixel = 0
    Frame.Position = lastPosition -- Utiliser la dernière position mémorisée
    Frame.Size = UDim2.new(0, 179, 0, 60)

    UICorner.Parent = Frame

    TextLabel.Parent = Frame
    TextLabel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    TextLabel.BackgroundTransparency = 0.700 -- Rendre le fond du TextLabel semi-transparent
    TextLabel.BorderColor3 = Color3.fromRGB(0, 0, 0)
    TextLabel.BorderSizePixel = 0
    TextLabel.Position = UDim2.new(0.11594753, 0, 0.129648343, 0)
    TextLabel.Size = UDim2.new(0, 137, 0, 44)
    TextLabel.Font = Enum.Font.SourceSans
    TextLabel.Text = "Anti AFK by FRITE"
    TextLabel.TextColor3 = Color3.fromRGB(186, 186, 186)
    TextLabel.TextSize = 14

    UICorner_2.Parent = TextLabel

    return ScreenGui -- Return the created ScreenGui for further use
end

-- Anti AFK Logic
local VirtualUser = game:GetService('VirtualUser')
local player = game.Players.LocalPlayer

-- Function to ensure GUI stays visible on respawn
local function setupGUI()
    -- Create the GUI and parent it to PlayerGui
    local gui = createGUI()
    gui.Parent = player:WaitForChild("PlayerGui")
    gui.Enabled = true -- Make sure the GUI is enabled

    -- Make the GUI draggable
    local Frame = gui.Frame
    local userInputService = game:GetService("UserInputService")
    local isDragging = false
    local dragStart = nil
    local startPos = nil
    
    local function onInputBegan(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            isDragging = true
            dragStart = input.Position
            startPos = Frame.Position

            -- Connect to InputEnded event to stop dragging
            userInputService.InputEnded:Connect(function(endInput)
                if endInput.UserInputType == Enum.UserInputType.MouseButton1 then
                    isDragging = false
                end
            end)
        end
    end
    
    local function onInputChanged(input)
        if isDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            Frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end
    
    -- Connect input events
    userInputService.InputBegan:Connect(onInputBegan)
    userInputService.InputChanged:Connect(onInputChanged)

    -- Enregistrer la position actuelle du Frame quand il est déplacé
    Frame:GetPropertyChangedSignal("Position"):Connect(function()
        lastPosition = Frame.Position
    end)
end

-- Function to detect when the player's health changes
local function onHealthChanged(health)
    if health <= 0 then
        setupGUI() -- Recreate the GUI when the player dies
    end
end

-- Function to handle character addition
local function onCharacterAdded(character)
    setupGUI() -- Call setup to ensure GUI is ready each time character spawns

    -- Detect health changes for the character
    local humanoid = character:WaitForChild("Humanoid")
    humanoid.HealthChanged:Connect(onHealthChanged)
end

-- Connect to the character added event
player.CharacterAdded:Connect(onCharacterAdded)

-- Ensure GUI is set up on initial load
if player.Character then
    onCharacterAdded(player.Character)
end

-- Initial setup
setupGUI()
